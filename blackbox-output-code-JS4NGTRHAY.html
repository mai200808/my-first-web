<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture Assistant - Web Ri√™ng</title>
    <style>
        /* CSS t·ªëi gi·∫£n, t√¥ng tr·∫Øng-ƒëen, responsive */
        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            color: #000000;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }
        h1 {
            color: #000000;
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .section {
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #000000;
            border-radius: 5px;
            background-color: #ffffff;
            box-sizing: border-box;
        }
        button {
            background-color: #000000;
            color: #ffffff;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 14px;
        }
        button:hover {
            background-color: #333333;
        }
        button:disabled {
            background-color: #666666;
            cursor: not-allowed;
        }
        textarea, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #000000;
            border-radius: 3px;
            font-size: 14px;
            resize: vertical;
            background-color: #ffffff;
            color: #000000;
            box-sizing: border-box;
        }
        #transcript, #summary {
            min-height: 100px;
            background-color: #f9f9f9;
            border: 1px solid #000000;
        }
        #chat-container {
            display: flex;
            flex-direction: column;
            height: 250px;
            border: 1px solid #000000;
            padding: 10px;
            background-color: #f9f9f9;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        .message {
            margin: 5px 0;
            padding: 8px;
            border-radius: 3px;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #ffffff;
            text-align: right;
            border-left: 3px solid #000000;
        }
        .ai-message {
            background-color: #e0e0e0;
            text-align: left;
            border-right: 3px solid #000000;
        }
        .status {
            color: #666666;
            font-style: italic;
            font-size: 12px;
        }
        @media (max-width: 600px) {
            body { padding: 5px; }
            h1 { font-size: 20px; }
            .section { padding: 10px; }
        }
    </style>
</head>
<body>
    <h1>Lecture Assistant - Web Ri√™ng C·ªßa B·∫°n</h1>
    <p class="status">C√¥ng c·ª• h·ªó tr·ª£ h·ªçc t·∫≠p: Ghi √¢m, chuy·ªÉn vƒÉn b·∫£n, t√≥m t·∫Øt, v√† h·ªèi ƒë√°p AI.</p>

    <!-- Ph·∫ßn ghi √¢m v√† chuy·ªÉn vƒÉn b·∫£n -->
    <div class="section">
        <h2>Ghi √¢m & Chuy·ªÉn vƒÉn b·∫£n</h2>
        <button id="startRecord">üé§ B·∫Øt ƒë·∫ßu ghi √¢m</button>
        <button id="stopRecord" disabled>‚èπÔ∏è D·ª´ng ghi √¢m</button>
        <button id="transcribe" disabled>üìù Chuy·ªÉn th√†nh vƒÉn b·∫£n</button>
        <button id="saveTranscript" disabled>üíæ L∆∞u transcript</button>
        <p class="status" id="recordingStatus">Nh·∫•n "B·∫Øt ƒë·∫ßu ghi √¢m" ƒë·ªÉ b·∫Øt ƒë·∫ßu. H·ªó tr·ª£ micro tr√¨nh duy·ªát.</p>
        <h3>Transcript (VƒÉn b·∫£n b√†i gi·∫£ng):</h3>
        <textarea id="transcript" placeholder="VƒÉn b·∫£n s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y sau khi chuy·ªÉn ƒë·ªïi..." readonly></textarea>
    </div>

    <!-- Ph·∫ßn t√≥m t·∫Øt -->
    <div class="section">
        <h2>T√≥m t·∫Øt b√†i gi·∫£ng</h2>
        <button id="summarize" disabled>T√≥m t·∫Øt nhanh</button>
        <h3>T√≥m t·∫Øt:</h3>
        <textarea id="summary" placeholder="T√≥m t·∫Øt s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y..." readonly></textarea>
        <p class="status">T√≥m t·∫Øt c∆° b·∫£n; c√≥ th·ªÉ n√¢ng c·∫•p b·∫±ng AI n·∫øu c·∫ßn.</p>
    </div>

    <!-- Ph·∫ßn h·ªèi ƒë√°p AI -->
    <div class="section">
        <h2>H·ªèi ƒë√°p v·ªõi AI v·ªÅ n·ªôi dung</h2>
        <div id="chat-container"></div>
        <input type="text" id="userInput" placeholder="Nh·∫≠p c√¢u h·ªèi v·ªÅ b√†i gi·∫£ng (v√≠ d·ª•: '√ù ch√≠nh l√† g√¨?')..." />
        <button id="sendQuestion">G·ª≠i c√¢u h·ªèi</button>
        <p class="status">D·ª±a tr√™n transcript. Thay API key OpenAI ƒë·ªÉ d√πng AI th·ª±c th·ª• (t√πy ch·ªçn).</p>
    </div>

    <script>
        // JavaScript ch√≠nh
        let mediaRecorder;
        let audioChunks = [];
        let recognition;
        let transcript = '';
        const OPENAI_API_KEY = 'YOUR_OPENAI_API_KEY'; // Thay b·∫±ng key OpenAI c·ªßa b·∫°n n·∫øu c√≥ (t√πy ch·ªçn)

        // Ghi √¢m
        document.getElementById('startRecord').addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUser Media({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    document.getElementById('transcribe').disabled = false;
                    document.getElementById('saveTranscript').disabled = true; // Enable sau khi c√≥ transcript
                    document.getElementById('recordingStatus').textContent = 'Ghi √¢m ho√†n t·∫•t. Nh·∫•n "Chuy·ªÉn th√†nh vƒÉn b·∫£n" ho·∫∑c nh·∫≠p th·ªß c√¥ng.';
                };

                mediaRecorder.start();
                document.getElementById('startRecord').disabled = true;
                document.getElementById('stopRecord').disabled = false;
                document.getElementById('recordingStatus').textContent = 'ƒêang ghi √¢m... N√≥i r√µ r√†ng v√† ch·ªù 5-10 gi√¢y.';
            } catch (err) {
                document.getElementById('recordingStatus').textContent = 'L·ªói truy c·∫≠p micro: ' + err.message;
            }
        });

        document.getElementById('stopRecord').addEventListener('click', () => {
            mediaRecorder.stop();
            mediaRecorder.stream.getTracks().forEach(track => track.stop()); // D·ª´ng stream
            document.getElementById('startRecord').disabled = false;
            document.getElementById('stopRecord').disabled = true;
        });

        // Chuy·ªÉn vƒÉn b·∫£n (Speech-to-Text real-time, h·ªó tr·ª£ ti·∫øng Vi·ªát)
        document.getElementById('transcribe').addEventListener('click', () => {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'vi-VN'; // Ti·∫øng Vi·ªát; ƒë·ªïi 'en-US' cho ti·∫øng Anh

                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            transcript += event.results[i][0].transcript + '. ';
                        } else {
                            interimTranscript += event.results[i][0].transcript;
                        }
                    }
                    document.getElementById('transcript').value = transcript + interimTranscript;
                    if (transcript) {
                        document.getElementById('saveTranscript').disabled = false;
                        document.getElementById('summarize').disabled = false;
                    }
                };

                recognition.onerror = (event) => {
                    console.error('L·ªói Speech Recognition:', event.error);
                    document.getElementById('recordingStatus').textContent = 'L·ªói: ' + event.error + '. Th·ª≠ l·∫°i ho·∫∑c d√πng Chrome.';
                };

                recognition.onend = () => {
                    document.getElementById('recordingStatus').textContent = 'Chuy·ªÉn ƒë·ªïi ho√†n t·∫•t. Transcript s·∫µn s√†ng.';
                };

                recognition.start();
                document.getElementById('recordingStatus').textContent = 'ƒêang l·∫Øng nghe... N√≥i b√†i gi·∫£ng c·ªßa b·∫°n.';
            } else {
                document.getElementById('recordingStatus').textContent = 'Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£. D√πng Chrome ho·∫∑c nh·∫≠p th·ªß c√¥ng v√†o transcript.';
            }
        });

        // L∆∞u transcript
        document.getElementById('saveTranscript').addEventListener('click', () => {
            const text = document.getElementById('transcript').value;
            if (text) {
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'transcript.txt';
                a.click();
                URL.revokeObjectURL(url);
            }
        });

        // T√≥m t·∫Øt (c∆° b·∫£n: r√∫t g·ªçn vƒÉn b·∫£n)
        document.getElementById('summarize').addEventListener('click', () => {
            const text = document.getElementById('transcript').value;
            if (text) {
                const sentences = text.split(/[.!?]+/).filter(s => s.trim()).slice(0, 5); // L·∫•y 5 c√¢u ƒë·∫ßu
                const summary = sentences.join('. ').substring(0, 300) + '... (T√≥m t·∫Øt t·ª± ƒë·ªông)';
                document.getElementById('summary').value = summary;
            } else {
                alert('C·∫ßn transcript tr∆∞·ªõc!');
            }
        });

        // H·ªèi ƒë√°p AI
        document.getElementById('sendQuestion').addEventListener('click', async () => {
            const userInput = document.getElementById('userInput').value.trim();
            if (!userInput) {
                alert('Vui l√≤ng nh·∫≠p c√¢u h·ªèi.');
                return;
            }
            if (!transcript) {
                alert('C·∫ßn transcript tr∆∞·ªõc ƒë·ªÉ AI tr·∫£ l·ªùi d·ª±a tr√™n n·ªôi dung.');
                return;
            }

            addMessage('B·∫°n: ' + userInput, 'user');
            document.getElementById('userInput').value = '';

            // N·∫øu c√≥ API key, g·ªçi OpenAI
            if (OPENAI_API_KEY && OPENAI_API_KEY !== 'YOUR_OPENAI_API_KEY') {
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${OPENAI_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo',
                            messages: [
                                { role: 'system', content: `B·∫°n l√† tr·ª£ l√Ω h·ªçc t·∫≠p ti·∫øng Vi·ªát. Tr·∫£ l·ªùi ng·∫Øn g·ªçn d·ª±a tr√™n transcript b√†i gi·∫£ng sau: "${transcript}"` },
                                { role: 'user', content: userInput }
                            ],
                            max_tokens: 200,
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) throw new Error('API error');
                    const data = await response.json();
                    addMessage('AI: ' + data.choices[0].message.content, 'ai');
                } catch (error) {
                    addMessage('AI: L·ªói k·∫øt n·ªëi OpenAI. Ki·ªÉm tra API key ho·∫∑c d√πng ch·∫ø ƒë·ªô c∆° b·∫£n.', 'ai');
                }
            } else {
                // Fallback: Ph·∫£n h·ªìi m·∫´u d·ª±a tr√™n transcript
                const sampleAnswer = `D·ª±a tr√™n b√†i gi·∫£ng: "${transcript.substring(0, 100)}...", c√¢u tr·∫£ l·ªùi cho "${userInput}" l√†: ƒê√¢y l√† √Ω ch√≠nh li√™n quan ƒë·∫øn ch·ªß ƒë·ªÅ b·∫°n h·ªèi. (ƒê·ªÉ d√πng AI th·ª±c, th√™m OpenAI API key v√†o m√£ ngu·ªìn.)`;
                addMessage('AI: ' + sampleAnswer, 'ai');
            }
        });

        function addMessage(text, className) {
            const chatContainer = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', className === 'user' ? 'user-message' : 'ai-message');
            messageDiv.textContent = text;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Enter ƒë·ªÉ g·ª≠i
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') document.getElementById('sendQuestion').click();
        });

        // Cho ph√©p nh·∫≠p th·ªß c√¥ng transcript n·∫øu kh√¥ng d√πng micro
        document.getElementById('transcript').removeAttribute('readonly'); // C√≥ th·ªÉ ch·ªânh s·ª≠a
        document.getElementById('transcript').addEventListener('input', () => {
            transcript = document.getElementById('transcript').value;
            if (transcript) {
                document.getElementById('saveTranscript').disabled = false;
                document.getElementById('summarize').disabled = false;
            }
        });
    </script>
</body>
</html>